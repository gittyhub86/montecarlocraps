"use strict";var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Craps=function(){function t(e,s,i,r,o,n,l,a){_classCallCheck(this,t),this.betAmt=e,this.tot=0,this.betFour=s,this.betFive=i,this.betSix=r,this.betEight=o,this.betNine=n,this.betTen=l,this.pass=a,this.passWin=0,this.passLoss=0,this.dontPassLoss=0,this.dontPassWin=0,this.diceRes=new Array,this.diceTot=null,this.point=null,this.totPlaceBet=s+i+r+o+n+l,this.placeBetPay={4:1.8,10:1.8,5:1.4,9:1.4,6:7/6,8:7/6},this.log=""}return _createClass(t,[{key:"comeOut",value:function(){if(!this.point)for(;!this.point;)this.rollDice(),this.pass?7===this.diceTot||11===this.diceTot?(this.log+="Rolled a 7 or 11. Win pass bet<br />",this.tot+=this.betAmt,this.printBalance(),this.passWin++,this.point=null):2===this.diceTot||3===this.diceTot||12===this.diceTot?(this.log+="Rolled a 2, 3 or 12. Lose pass bet<br />",this.tot-=this.betAmt,this.printBalance(),this.passLoss++,this.point=null):this.point=this.diceTot:7===this.diceTot||11===this.diceTot?(this.log+="Rolled a 7 or 11. Lose don't pass bet<br />",this.tot-=this.betAmt,this.printBalance(),this.dontPassLoss++,this.point=null):2===this.diceTot||3===this.diceTot?(this.log+="Rolled a 2 or 3. Win don't pass bet<br />",this.tot+=this.betAmt,this.printBalance(),this.dontPassWin++,this.point=null):12!==this.diceTot&&(this.point=this.diceTot),this.point&&(this.log+="Point is: "+this.point+"<br />")}},{key:"pointRound",value:function(){if(this.point)for(;this.point;)this.rollDice(),this.payPlaceBet(),this.point!==this.diceTot||this.pass?this.point===this.diceTot&&this.pass?(this.log+="Rolled point before 7. Won pass bet<br />",this.tot+=this.betAmt,this.printBalance(),this.passWin++,this.point=null):7===this.diceTot&&(this.pass?(this.log+="Rolled 7 before point. Lost pass & any place bets<br />",this.passLoss++,this.tot-=this.betAmt+this.totPlaceBet,this.printBalance(),this.point=null):(this.log+="Rolled 7 before point. Won don't pass bet, but lost any place bets<br />",this.dontPassWin++,this.tot+=this.betAmt-this.totPlaceBet,this.printBalance(),this.point=null)):(this.log+="Rolled point before 7. Lost don't pass bet<br />",this.tot-=this.betAmt,this.printBalance(),this.dontPassLoss++,this.point=null)}},{key:"rollDice",value:function(){this.diceRes[0]=this.getRandom(),this.diceRes[1]=this.getRandom(),this.diceTot=this.diceRes[0]+this.diceRes[1],this.log+="Player rolled "+this.diceRes[0]+", "+this.diceRes[1]+"<br />"}},{key:"payPlaceBet",value:function(){4===this.diceTot&&this.betFour?(this.tot+=this.placeBetPay[this.diceTot]*this.betFour,this.log+="Rolled 4. Pay place bet<br />",this.printBalance()):5===this.diceTot&&this.betFive?(this.tot+=this.placeBetPay[this.diceTot]*this.betFive,this.log+="Rolled 5. Pay place bet<br />",this.printBalance()):6===this.diceTot&&this.betSix?(this.tot+=this.placeBetPay[this.diceTot]*this.betSix,this.log+="Rolled 6. Pay place bet<br />",this.printBalance()):8===this.diceTot&&this.betEight?(this.tot+=this.placeBetPay[this.diceTot]*this.betEight,this.log+="Rolled 8. Pay place bet<br />",this.printBalance()):9===this.diceTot&&this.betNine?(this.tot+=this.placeBetPay[this.diceTot]*this.betNine,this.log+="Rolled 9; pay place bet<br />",this.printBalance()):10===this.diceTot&&this.betTen&&(this.tot+=this.placeBetPay[this.diceTot]*this.betTen,this.log+="Rolled 10; pay place bet<br />",this.printBalance())}},{key:"getRandom",value:function(){return Math.floor(6*Math.random()+1)}},{key:"printBalance",value:function(){this.log+="Amount won/loss ",this.log+=this.tot<0?"-$"+Math.abs(this.tot).toLocaleString()+"<br />":"$"+this.tot.toLocaleString()+"<br />"}}]),t}();function crapsSim(t,e,s,i,r,o,n,l,a,h,c){var u,p="",b=0,d=0,m=0,g=0,f=1,T=1,v=void 0,P=[],A=[];v=new Craps(i,r,o,n,l,a,h,!!c);try{for(var R=1;R<s+1;R++,T++){for(var y=1;y<e+1;y++,f++)p+="<h4>Trial "+R.toLocaleString()+", Round "+y.toLocaleString()+"</h4>",v.comeOut(),v.pointRound(),p+=v.log+"<br />",v.log="",f%5==0&&(P.push(p),p="");A.push(v.tot),c?(b+=v.passWin,d+=v.passLoss):(m+=v.dontPassWin,g+=v.dontPassLoss),(u=v).log="",u.tot=0,u.passWin=0,u.passLoss=0,u.dontPassLoss=0,u.dontPassWin=0,u.diceTot=null,u.point=null}p&&(P.push(p),p=""),t.ctrl.resLog+=c?"<p>Total pass bet wins: "+b.toLocaleString()+"</p>\n\t\t\t\t\t\t\t\t<p>Total pass bet losses: "+d.toLocaleString()+"</p>":"<p>Total don't pass bet wins: "+m.toLocaleString()+"</p>\n\t\t\t\t\t\t\t\t<p>Total don't pass bet losses: "+g.toLocaleString()+"</p>"}catch(e){t.ctrl.errArr.push("Error: Please try running less rounds and/or less number of trials")}return[A,P]}function appendTrialRes(t,e){var s=angular.element("<div>");if(Array.isArray(t)){s.addClass("row");var i="";t.forEach(function(t,s){t=t>=0?"$"+roundNum(t):"-$"+roundNum(Math.abs(t)),i+='<span class="trial">Trial '+e.ctrl.trialResultCounter+++": "+t+"</span>"}),s.html(i)}return s}function roundNum(t){return Number(Math.round(t+"e2")+"e-2").toLocaleString()}function createShowMore(t,e,s,i,r){var o=angular.element("<div>");o.attr(i,""),o.addClass(r),o.html("<span>Show More</span>"),e.append(o[0]),s(o)(t)}function loading(t){$(t).text("Loading...")}function reset(t){$("[data-append-result]").children().remove(),t.ctrl.trialResults=[],t.ctrl.showMoreLogs=[],t.ctrl.resLog="",t.ctrl.errArr=[],t.ctrl.trialResultCounter=1}function validateUserInput(t){return t.ctrl.roundsPerTrial*t.ctrl.numTrials>9e5&&t.ctrl.errArr.push("Error: Please try running less rounds and/or less number of trials"),isNaN(t.ctrl.roundsPerTrial)&&isNaN(t.ctrl.numTrials)&&t.ctrl.errArr.push("Please enter a number for Rounds per trial/Number of trials"),(isNaN(t.ctrl.roundsPerTrial)||null===t.ctrl.roundsPerTrial)&&t.ctrl.errArr.push("Rounds per trial must be a number greater than 1"),(isNaN(t.ctrl.numTrials)||null===t.ctrl.numTrials)&&t.ctrl.errArr.push("Number of trials must be a number greater than 1"),(t.ctrl.betAmt<=0||isNaN(t.ctrl.betAmt)||null===t.ctrl.betAmt)&&t.ctrl.errArr.push("Pass/Don't pass bet amount must be a number greater than 0"),!0!==t.ctrl.passLine&&!1!==t.ctrl.passLine&&t.ctrl.errArr.push("Pass bet must be checked or unchecked"),(isNaN(t.ctrl.betFour)||null===t.ctrl.betFour)&&t.ctrl.errArr.push("Place bet 4 must be a number"),(isNaN(t.ctrl.betFive)||null===t.ctrl.betFive)&&t.ctrl.errArr.push("Place bet 5 must be a number"),(isNaN(t.ctrl.betSix)||null===t.ctrl.betSix)&&t.ctrl.errArr.push("Place bet 6 must be a number"),(isNaN(t.ctrl.betEight)||null===t.ctrl.betEight)&&t.ctrl.errArr.push("Place bet 8 must be a number"),(isNaN(t.ctrl.betNine)||null===t.ctrl.betNine)&&t.ctrl.errArr.push("Place bet 9 must be a number"),(isNaN(t.ctrl.betTen)||null===t.ctrl.betTen)&&t.ctrl.errArr.push("Place bet 10 must be a number"),!(t.ctrl.errArr.length>0)}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function runSim(t,e){return{restrict:"A",link:function(s,i,r,o){i.on("click",function(){s.$apply(function(){var i;(reset(s),validateUserInput(s))&&(i=t.defer(),s.ctrl.isLoading=!0,s.ctrl.disableButton=!0,e(function(){i.resolve()},100),i.promise).then(function(){var t=crapsSim(s,s.ctrl.roundsPerTrial,s.ctrl.numTrials,s.ctrl.betAmt,s.ctrl.betFour,s.ctrl.betFive,s.ctrl.betSix,s.ctrl.betEight,s.ctrl.betNine,s.ctrl.betTen,s.ctrl.passLine);s.$broadcast.apply(s,["start-sim"].concat(_toConsumableArray(t)))})})})}}}function appendResult(t,e,s){return{restrict:"A",link:function(i,r,o,n){i.$on("start-sim",function(o,n,l){(function(o,n){var l=t.defer();if(o.length){var a=appendTrialRes(o.splice(0,20),i);r.append(a),o.length&&(i.ctrl.trialResults=o,createShowMore(i,r,s,"show-more-trial","show-more show-more-trial"))}if(n.length){var h=n.shift(),c=angular.element("<div>");c.append(h),r.append(c),n.length&&(i.ctrl.showMoreLogs=n,createShowMore(i,r,s,"show-more","show-more"))}return e(function(){l.resolve()},100),l.promise})(n,l).then(function(){i.ctrl.isLoading=!1,i.ctrl.disableButton=!1})})}}}function showMoreTrial(t){return{restrict:"A",link:function(e,s,i,r){s.on("click",function(){loading("[show-more-trial]");var i=appendTrialRes(e.ctrl.trialResults.splice(0,20),e),r=$(".row")[0];s.remove(),r.append(i[0]),e.ctrl.trialResults.length&&createShowMore(e,r,t,"show-more-trial","show-more show-more-trial")})}}}function showMore(t){return{restrict:"A",link:function(e,s,i,r){s.on("click",function(){loading("[show-more]");var i=e.ctrl.showMoreLogs.shift(),r=angular.element("<div>");r.append(i);var o=s.parent();s.remove(),o.append(r),e.ctrl.showMoreLogs.length&&createShowMore(e,o,t,"show-more","show-more")})}}}function SimCtrl(){this.roundsPerTrial=1,this.numTrials=1,this.betAmt=5,this.passLine=!0,this.betFour=0,this.betFive=0,this.betSix=0,this.betEight=0,this.betNine=0,this.betTen=0,this.disableButton=!1,this.resLog="",this.errArr=[],this.isLoading=!1,this.trialResultCounter=1}function trusted(t){return function(e){return t.trustAsHtml(e)}}angular.module("main",["ngRoute","core"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"templates/monte_carlo.html",controller:"simCtrl",controllerAs:"ctrl"})}]),angular.module("core",[]).controller("simCtrl",SimCtrl).directive("runSim",["$q","$timeout",runSim]).directive("appendResult",["$q","$timeout","$compile",appendResult]).directive("showMoreTrial",["$compile",showMoreTrial]).directive("showMore",["$compile",showMore]).filter("trusted",["$sce",trusted]);